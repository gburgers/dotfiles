#!/usr/bin/env bash
set -e

# 1. Ensure we are on main
git checkout main

# 2. Sync with remote main safely
git fetch origin
#--ff-only = “fast-forward only” means:
# If main is behind origin/main → update it
# If someone force-pushed or rewrote history → fail loudly (so you notice something weird)
git pull --ff-only origin main

# 3. Ask for version number
echo "Enter release version (e.g. v0.0.2):"
read VERSION

# 4. Create annotated tag
git tag -a "$VERSION" -m "Release $VERSION"

# 5. Push tag
git push origin "$VERSION"

echo "✔ Release $VERSION pushed!"
echo "GitHub Actions will now build the production image."

